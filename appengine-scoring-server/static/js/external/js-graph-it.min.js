function DocumentScanner(t,e){this.visitor=t,this.scanElementsOnly=e,this.scan=function(t){var e;if(this.visitor.visit(t)){var n=t.childNodes;for(e=0;e<n.length;e++)this.scanElementsOnly&&1!=n[e].nodeType||this.scan(n[e])}}}function BlocksToMoveVisitor(){this.visit=function(t){return isBlock(t)?(blocksToMove.push(findBlock(t.id)),!1):!0}}function movemouse(t){if(isdrag){var e=nn6?t.clientX:event.clientX,n=nn6?t.clientY:event.clientY,s=elementStartX+e-mouseStartX,i=elementStartY+n-mouseStartY;s<bounds[0]&&(s=bounds[0]+1),s+elementToMove.offsetWidth>bounds[2]&&(s=bounds[2]-elementToMove.offsetWidth-1),i<bounds[1]&&(i=bounds[1]+1),i+elementToMove.offsetHeight>bounds[3]&&(i=bounds[3]-elementToMove.offsetHeight-1),elementToMove.style.left=s+"px",elementToMove.style.top=i+"px",elementToMove.style.right=null,elementToMove.style.bottom=null;var h;for(h=0;h<blocksToMove.length;h++)blocksToMove[h].onMove();return!1}}function startDrag(t){var e=nn6?t.target:event.srcElement;if("HTML"!=e.tagName){for(;e!=document.body&&!hasClass(e,"draggable");)e=nn6?e.parentNode:e.parentElement;return hasClass(e,"draggable")?(isdrag=!0,elementToMove=e,elementToMove.style.position="absolute",elementStartX=elementToMove.offsetLeft,elementStartY=elementToMove.offsetTop,mouseStartX=nn6?t.clientX:event.clientX,mouseStartY=nn6?t.clientY:event.clientY,"absolute"==getStyle(elementToMove.parentNode,"position")?(bounds[0]=0,bounds[1]=0):(bounds[0]=calculateOffsetLeft(elementToMove.parentNode),bounds[1]=calculateOffsetTop(elementToMove.parentNode)),bounds[2]=bounds[0]+elementToMove.parentNode.offsetWidth,bounds[3]=bounds[1]+elementToMove.parentNode.offsetHeight,blocksToMove=new Array,blocksToMoveScanner.scan(e),document.onmousemove=movemouse,originalZIndex=getStyle(elementToMove,"z-index"),elementToMove.style.zIndex="3",!1):void 0}}function stopDrag(){isdrag=!1,elementToMove&&(elementToMove.style.zIndex=originalZIndex),elementToMove=null,document.onmousemove=null}function Canvas(t){this.id=t.id,this.htmlElement=t,this.blocks=new Array,this.connectors=new Array,this.offsetLeft=calculateOffsetLeft(this.htmlElement),this.offsetTop=calculateOffsetTop(this.htmlElement),this.width,this.height,this.innerDiv=document.createElement("div"),this.initCanvas=function(){var t,e,n=this.htmlElement.childNodes,s=n.length;for(t=0;s>t;t++)e=n[0],this.htmlElement.removeChild(e),this.innerDiv.appendChild(e),e.style&&(e.style.zIndex="2");this.htmlElement.appendChild(this.innerDiv),this.htmlElement.style.overflow="auto",this.htmlElement.style.position="relative",this.innerDiv.id=this.id+"_innerDiv",this.innerDiv.style.border="none",this.innerDiv.style.padding="0px",this.innerDiv.style.margin="0px",this.innerDiv.style.position="absolute",this.innerDiv.style.top="0px",this.innerDiv.style.left="0px",this.width=0,this.height=0,this.offsetLeft=calculateOffsetLeft(this.innerDiv),this.offsetTop=calculateOffsetTop(this.innerDiv),new DocumentScanner(this,!0).scan(this.htmlElement),this.height+=2,this.width+=2;var i=this.htmlElement.offsetWidth-2,h=this.htmlElement.offsetHeight-2;for(this.height>h&&(i-=SCROLLBARS_WIDTH),this.width>i&&(h-=SCROLLBARS_WIDTH),this.height=Math.max(this.height,h),this.width=Math.max(this.width,i),this.innerDiv.style.width=this.width+"px",this.innerDiv.style.height=this.height+"px",t=0;t<this.connectors.length;t++)this.connectors[t].initConnector()},this.visit=function(t){if(t==this.htmlElement)return!0;if(this.width=Math.max(this.width,calculateOffsetLeft(t)-this.offsetLeft+t.offsetWidth),this.height=Math.max(this.height,calculateOffsetTop(t)-this.offsetTop+t.offsetHeight),isBlock(t)){var e=new Block(t,this);return e.initBlock(),this.blocks.push(e),!1}if(isConnector(t)){var n=new Connector(t,this);return this.connectors.push(n),!1}return!0},this.print=function(){var t,e="<ul><legend>canvas: "+this.id+"</legend>";for(t=0;t<this.blocks.length;t++)e+="<li>",e+=this.blocks[t].print(),e+="</li>";return e+="</ul>"},this.findBlock=function(t){var e,n;for(n=0;n<this.blocks.length&&!e;n++)e=this.blocks[n].findBlock(t);return e},this.toString=function(){return"canvas: "+this.id}}function Block(t,e){if(this.canvas=e,this.htmlElement=t,this.id=t.id,this.blocks=new Array,this.moveListeners=new Array,"description2_out1"==this.id);this.currentTop=calculateOffsetTop(this.htmlElement)-this.canvas.offsetTop,this.currentLeft=calculateOffsetLeft(this.htmlElement)-this.canvas.offsetLeft,this.visit=function(t){if(t==this.htmlElement)return!0;if(isBlock(t)){var e=new Block(t,this.canvas);return e.initBlock(),this.blocks.push(e),this.moveListeners.push(e),!1}return!0},this.initBlock=function(){new DocumentScanner(this,!0).scan(this.htmlElement)},this.top=function(){return this.currentTop},this.left=function(){return this.currentLeft},this.width=function(){return this.htmlElement.offsetWidth},this.height=function(){return this.htmlElement.offsetHeight},this.print=function(){var t="block: "+this.id;if(this.blocks.length>0){t+="<ul>";var e;for(e=0;e<this.blocks.length;e++)t+="<li>",t+=this.blocks[e].print(),t+="</li>";t+="</ul>"}return t},this.findBlock=function(t){if(this.id==t)return this;var e,n;for(n=0;n<this.blocks.length&&!e;n++)e=this.blocks[n].findBlock(t);return e},this.move=function(t,e){this.htmlElement.style.left=t,this.htmlElement.style.top=e,this.onMove()},this.onMove=function(){var t;for(this.currentLeft=calculateOffsetLeft(this.htmlElement)-this.canvas.offsetLeft,this.currentTop=calculateOffsetTop(this.htmlElement)-this.canvas.offsetTop,t=0;t<this.moveListeners.length;t++)this.moveListeners[t].onMove()},this.toString=function(){return"block: "+this.id}}function Segment(t,e){this.id=t,this.htmlElement=document.createElement("div"),this.htmlElement.id=t,this.htmlElement.style.position="absolute",this.htmlElement.style.overflow="hidden",e.appendChild(this.htmlElement),this.startX,this.startY,this.length,this.thickness,this.orientation,this.nextSegment,this.visible=!0,this.draw=function(){switch(this.nextSegment&&(this.nextSegment.startX=this.getEndX(),this.nextSegment.startY=this.getEndY()),this.htmlElement.style.display=this.visible?"block":"none",this.orientation){case LEFT:this.htmlElement.style.left=this.startX-this.length+"px",this.htmlElement.style.top=this.startY+"px",this.htmlElement.style.width=this.length+"px",this.htmlElement.style.height=this.thickness+"px";break;case RIGHT:this.htmlElement.style.left=this.startX+"px",this.htmlElement.style.top=this.startY+"px",this.htmlElement.style.width=this.nextSegment?this.length+this.thickness+"px":this.length+"px",this.htmlElement.style.height=this.thickness+"px";break;case UP:this.htmlElement.style.left=this.startX+"px",this.htmlElement.style.top=this.startY-this.length+"px",this.htmlElement.style.width=this.thickness+"px",this.htmlElement.style.height=this.length+"px";break;case DOWN:this.htmlElement.style.left=this.startX+"px",this.htmlElement.style.top=this.startY+"px",this.htmlElement.style.width=this.thickness+"px",this.htmlElement.style.height=this.nextSegment?this.length+this.thickness+"px":this.length+"px"}this.nextSegment&&this.nextSegment.draw()},this.getEndX=function(){switch(this.orientation){case LEFT:return this.startX-this.length;case RIGHT:return this.startX+this.length;case DOWN:return this.startX;case UP:return this.startX}},this.getEndY=function(){switch(this.orientation){case LEFT:return this.startY;case RIGHT:return this.startY;case DOWN:return this.startY+this.length;case UP:return this.startY-this.length}},this.append=function(t){t&&(this.nextSegment?this.nextSegment.append(t):(this.nextSegment=t,this.nextSegment.startX=this.getEndX(),this.nextSegment.startY=this.getEndY()))},this.detach=function(){var t=this.nextSegment;return this.nextSegment=null,t},this.cascadeHide=function(){this.visible=!1,this.nextSegment&&this.nextSegment.cascadeHide()}}function Connector(t,e){this.htmlElement=t,this.canvas=e,this.source=null,this.destination=null,this.preferredSourceOrientation=AUTO,this.preferredDestinationOrientation=AUTO,this.connectorClass,this.minSegmentLength=10,this.size=1,this.color="black",this.moveListeners=new Array,this.firstSegment,this.segmentsPool,this.segmentsNumber=0,this.strategy,this.initConnector=function(){this.id=this.htmlElement.id?this.htmlElement.id:this.htmlElement.className;var e=t.className.split(" ");if(e.length<3)return void console.log("Unable to create connector '"+id+"', class is not in the correct format: connector <sourceBlockId>, <destBlockId>");if(this.connectorClass=e[0]+" "+e[1]+" "+e[2],this.source=this.canvas.findBlock(e[1]),!this.source)return void console.log("cannot find source block with id '"+e[1]+"'");if(this.destination=this.canvas.findBlock(e[2]),!this.destination)return void console.log("cannot find destination block with id '"+e[2]+"'");hasClass(this.htmlElement,"vertical")?(this.preferredSourceOrientation=VERTICAL,this.preferredDestinationOrientation=VERTICAL):hasClass(this.htmlElement,"horizontal")?(this.preferredSourceOrientation=HORIZONTAL,this.preferredDestinationOrientation=HORIZONTAL):(hasClass(this.htmlElement,"vertical_start")?this.preferredSourceOrientation=VERTICAL:hasClass(this.htmlElement,"horizontal_start")?this.preferredSourceOrientation=HORIZONTAL:hasClass(this.htmlElement,"left_start")?this.preferredSourceOrientation=LEFT:hasClass(this.htmlElement,"right_start")?this.preferredSourceOrientation=RIGHT:hasClass(this.htmlElement,"up_start")?this.preferredSourceOrientation=UP:hasClass(this.htmlElement,"down_start")&&(this.preferredSourceOrientation=DOWN),hasClass(this.htmlElement,"vertical_end")?this.preferredDestinationOrientation=VERTICAL:hasClass(this.htmlElement,"horizontal_end")?this.preferredDestinationOrientation=HORIZONTAL:hasClass(this.htmlElement,"left_end")?this.preferredDestinationOrientation=LEFT:hasClass(this.htmlElement,"right_end")?this.preferredDestinationOrientation=RIGHT:hasClass(this.htmlElement,"up_end")?this.preferredDestinationOrientation=UP:hasClass(this.htmlElement,"down_end")&&(this.preferredDestinationOrientation=DOWN)),this.strategy=strategies[0](this),this.repaint(),this.source.moveListeners.push(this),this.destination.moveListeners.push(this);var n;for(n=0;n<inspectors.length;n++)inspectors[n].inspect(this);this.htmlElement.parentNode.removeChild(this.htmlElement)},this.getStartSegment=function(){return this.firstSegment},this.getEndSegment=function(){for(var t=this.firstSegment;t.nextSegment;)t=t.nextSegment;return t},this.getMiddleSegment=function(){return this.strategy?this.strategy.getMiddleSegment():null},this.createSegment=function(){var t;return this.segmentsPool?(t=this.segmentsPool,this.segmentsPool=this.segmentsPool.detach()):(t=new Segment(this.id+"_"+(this.segmentsNumber+1),this.canvas.htmlElement),t.htmlElement.className=this.connectorClass,getStyle(t.htmlElement,"background-color")||(t.htmlElement.style.backgroundColor=this.color),t.thickness=this.size),this.segmentsNumber++,this.firstSegment?this.firstSegment.append(t):this.firstSegment=t,t.visible=!0,t},this.repaint=function(){var t,e,n,s=0;for(t=0;t<strategies.length;t++)this.clearSegments(),e=0,n=strategies[t](this),n.isApplicable()&&(e++,n.paint(),0!=(this.firstSegment.orientation&this.preferredSourceOrientation)&&e++,0!=(this.getEndSegment().orientation&this.preferredDestinationOrientation)&&e++),e>s&&(this.strategy=n,s=e);this.clearSegments(),this.strategy.paint(),this.firstSegment.draw(),this.segmentsPool&&this.segmentsPool.draw()},this.clearSegments=function(){this.firstSegment&&(this.firstSegment.cascadeHide(),this.firstSegment.append(this.segmentsPool),this.segmentsPool=this.firstSegment,this.firstSegment=null)},this.onMove=function(){this.repaint();var t;for(t=0;t<this.moveListeners.length;t++)this.moveListeners[t].onMove()}}function ConnectorEnd(t,e,n){this.side=n,this.htmlElement=t,this.connector=e,e.canvas.htmlElement.appendChild(t),"img"==this.htmlElement.tagName.toLowerCase()&&(this.src=this.htmlElement.src.substring(0,this.htmlElement.src.lastIndexOf(".")),this.srcExtension=this.htmlElement.src.substring(this.htmlElement.src.lastIndexOf(".")),this.htmlElement.style.zIndex=getStyle(this.connector.htmlElement,"z-index")),this.orientation,this.repaint=function(){this.htmlElement.style.position="absolute";var t,n,s,i;switch(this.side==START?(s=e.getStartSegment(),t=s.startX,n=s.startY,i=s.orientation,i=0!=(i&VERTICAL)?~i&VERTICAL:~i&HORIZONTAL):(s=e.getEndSegment(),t=s.getEndX(),n=s.getEndY(),i=s.orientation),i){case LEFT:n-=(this.htmlElement.offsetHeight-s.thickness)/2;break;case RIGHT:t-=this.htmlElement.offsetWidth,n-=(this.htmlElement.offsetHeight-s.thickness)/2;break;case DOWN:n-=this.htmlElement.offsetHeight,t-=(this.htmlElement.offsetWidth-s.thickness)/2;break;case UP:t-=(this.htmlElement.offsetWidth-s.thickness)/2}if(this.htmlElement.style.left=Math.ceil(t)+"px",this.htmlElement.style.top=Math.ceil(n)+"px","img"==this.htmlElement.tagName.toLowerCase()&&this.orientation!=i){var h;switch(i){case UP:h="u";break;case DOWN:h="d";break;case LEFT:h="l";break;case RIGHT:h="r"}this.htmlElement.src=this.src+"_"+h+this.srcExtension}this.orientation=i},this.onMove=function(){this.repaint()}}function SideConnectorLabel(t,e,n){this.connector=t,this.htmlElement=e,this.side=n,this.connector.htmlElement.parentNode.appendChild(e),this.repaint=function(){this.htmlElement.style.position="absolute";var t,e,n;this.side==START?(n=this.connector.getStartSegment(),t=n.startX,e=n.startY,n.orientation==LEFT&&(t-=this.htmlElement.offsetWidth),n.orientation==UP&&(e-=this.htmlElement.offsetHeight),0!=(n.orientation&HORIZONTAL)&&e<this.connector.getEndSegment().getEndY()&&(e-=this.htmlElement.offsetHeight),0!=(n.orientation&VERTICAL)&&t<this.connector.getEndSegment().getEndX()&&(t-=this.htmlElement.offsetWidth)):(n=this.connector.getEndSegment(),t=n.getEndX(),e=n.getEndY(),n.orientation==RIGHT&&(t-=this.htmlElement.offsetWidth),n.orientation==DOWN&&(e-=this.htmlElement.offsetHeight),0!=(n.orientation&HORIZONTAL)&&e<this.connector.getStartSegment().startY&&(e-=this.htmlElement.offsetHeight),0!=(n.orientation&VERTICAL)&&t<this.connector.getStartSegment().startX&&(t-=this.htmlElement.offsetWidth)),this.htmlElement.style.left=Math.ceil(t)+"px",this.htmlElement.style.top=Math.ceil(e)+"px"},this.onMove=function(){this.repaint()}}function MiddleConnectorLabel(t,e){this.connector=t,this.htmlElement=e,this.connector.canvas.htmlElement.appendChild(e),this.repaint=function(){this.htmlElement.style.position="absolute";var e,n,s=t.getMiddleSegment();0!=(s.orientation&VERTICAL)?(n=s.htmlElement.offsetTop+(s.htmlElement.offsetHeight-this.htmlElement.offsetHeight)/2,e=s.htmlElement.offsetLeft):(n=s.htmlElement.offsetTop,e=s.htmlElement.offsetLeft+(s.htmlElement.offsetWidth-this.htmlElement.offsetWidth)/2),this.htmlElement.style.left=Math.ceil(e)+"px",this.htmlElement.style.top=Math.ceil(n)+"px"},this.onMove=function(){this.repaint()}}function ConnectorEndsInspector(){this.inspect=function(t){var e,n=t.htmlElement.childNodes;for(e=0;e<n.length;e++)if(hasClass(n[e],"connector-end")){var s=new ConnectorEnd(n[e],t,END);s.repaint(),t.moveListeners.push(s)}else if(hasClass(n[e],"connector-start")){var s=new ConnectorEnd(n[e],t,START);s.repaint(),t.moveListeners.push(s)}}}function ConnectorLabelsInspector(){this.inspect=function(t){var e,n=t.htmlElement.childNodes;for(e=0;e<n.length;e++)if(hasClass(n[e],"source-label")){var s=new SideConnectorLabel(t,n[e],START);s.repaint(),t.moveListeners.push(s)}else if(hasClass(n[e],"middle-label")){var s=new MiddleConnectorLabel(t,n[e]);s.repaint(),t.moveListeners.push(s)}else if(hasClass(n[e],"destination-label")){var s=new SideConnectorLabel(t,n[e],END);s.repaint(),t.moveListeners.push(s)}}}function initPageObjects(){if(isCanvas(document.body)){var t=new Canvas(document.body);t.initCanvas(),canvases.push(t)}else{var e,n=document.getElementsByTagName("div");for(e=0;e<n.length;e++)if(isCanvas(n[e])&&!findCanvas(n[e].id)){var t=new Canvas(n[e]);t.initCanvas(),canvases.push(t)}}}function findCanvas(t){var e;for(e=0;e<canvases.length;e++)if(canvases[e].id==t)return canvases[e];return null}function findBlock(t){var e;for(e=0;e<canvases.length;e++){var n=canvases[e].findBlock(t);if(n)return n}return null}function isBlock(t){return hasClass(t,"block")}function isCanvas(t){return hasClass(t,"canvas")}function isConnector(t){return t.className&&t.className.match(new RegExp("connector .*"))}function calculateOffsetTop(t){var e=0;if(t.offsetParent)for(e=t.offsetTop;t=t.offsetParent;)e+=t.offsetTop;else t.y&&(e+=t.y);return e}function calculateOffsetLeft(t){var e=0;if(t.offsetParent)for(e=t.offsetLeft;t=t.offsetParent;)e+=t.offsetLeft;else t.x&&(e+=t.x);return e}function parseBorder(t,e){var n=getStyle(t,"border-"+e+"-width");return n&&""!=n&&"px"==n.substring(n.length-2)?parseInt(n.substring(0,n.length-2)):0}function hasClass(t,e){if(!t||!t.className)return!1;var n,s=t.className.split(" ");for(n=0;n<s.length;n++)if(s[n]==e)return!0;return!1}function getStyle(t,e){if(1==t.nodeType){var n;return t.currentStyle?(e=replaceDashWithCamelNotation(e),n=t.currentStyle[e]):window.getComputedStyle&&(n=document.defaultView.getComputedStyle(t,null).getPropertyValue(e)),n}}function replaceDashWithCamelNotation(t){for(var e=t.indexOf("-");e>0&&t.length>e+1;)t=t.substring(0,e)+t.substring(e+1,e+2).toUpperCase()+t.substring(e+2),e=t.indexOf("-");return t}function HorizontalSStrategy(t){this.connector=t,this.startSegment,this.middleSegment,this.endSegment,this.strategyName="horizontal_s",this.getMiddleSegment=function(){return this.middleSegment},this.isApplicable=function(){var t=this.connector.source.left(),e=this.connector.source.width(),n=this.connector.destination.left(),s=this.connector.destination.width();return Math.abs(2*n+s-(2*t+e))-(e+s)>4*this.connector.minSegmentLength},this.paint=function(){this.startSegment=t.createSegment(),this.middleSegment=t.createSegment(),this.endSegment=t.createSegment();var e,n=this.connector.source.left(),s=this.connector.source.top(),i=this.connector.source.width(),h=this.connector.source.height(),o=this.connector.destination.left(),r=this.connector.destination.top(),a=this.connector.destination.width(),l=this.connector.destination.height();this.startSegment.startY=Math.floor(s+h/2),o+a/2>n+i/2?(this.startSegment.startX=n+i,e=o-(n+i)):(this.startSegment.startX=n,e=o+a-n),this.startSegment.length=Math.floor(Math.abs(e)/2),this.startSegment.orientation=e>0?RIGHT:LEFT;var c=Math.floor(r+l/2-(s+h/2));this.middleSegment.length=Math.abs(c),0==c&&(this.middleSegment.visible=!1),this.middleSegment.orientation=c>0?DOWN:UP,this.endSegment.length=Math.floor(Math.abs(e)/2),this.endSegment.orientation=e>0?RIGHT:LEFT}}function VerticalSStrategy(t){this.connector=t,this.startSegment,this.middleSegment,this.endSegment,this.strategyName="vertical_s",this.getMiddleSegment=function(){return this.middleSegment},this.isApplicable=function(){var t=this.connector.source.top(),e=this.connector.source.height(),n=this.connector.destination.top(),s=this.connector.destination.height();return Math.abs(2*n+s-(2*t+e))-(e+s)>4*this.connector.minSegmentLength},this.paint=function(){this.startSegment=t.createSegment(),this.middleSegment=t.createSegment(),this.endSegment=t.createSegment();var e,n=this.connector.source.left(),s=this.connector.source.top(),i=this.connector.source.width(),h=this.connector.source.height(),o=this.connector.destination.left(),r=this.connector.destination.top(),a=this.connector.destination.width(),l=this.connector.destination.height();this.startSegment.startX=Math.floor(n+i/2),r+l/2>s+h/2?(this.startSegment.startY=s+h,e=r-(s+h)):(this.startSegment.startY=s,e=r+l-s),this.startSegment.length=Math.floor(Math.abs(e)/2),this.startSegment.orientation=e>0?DOWN:UP;var c=Math.floor(o+a/2-(n+i/2));this.middleSegment.length=Math.abs(c),this.middleSegment.orientation=c>0?RIGHT:LEFT,this.endSegment.length=Math.floor(Math.abs(e)/2),this.endSegment.orientation=e>0?DOWN:UP}}function HorizontalLStrategy(t){this.connector=t,this.destination,this.startSegment,this.endSegment,this.strategyName="horizontal_L",this.isApplicable=function(){var t=Math.floor(this.connector.destination.left()+this.connector.destination.width()/2),e=this.connector.source.left(),n=this.connector.source.width(),s=this.connector.destination.top(),i=this.connector.destination.height(),h=Math.floor(this.connector.source.top()+this.connector.source.height()/2);return t>e&&e+n>t?!1:h>s&&s+i>h?!1:!0},this.getMiddleSegment=function(){return this.startSegment.length>this.endSegment.length?this.startSegment:this.endSegment},this.paint=function(){this.startSegment=this.connector.createSegment(),this.endSegment=this.connector.createSegment();var t=Math.floor(this.connector.destination.left()+this.connector.destination.width()/2),e=this.connector.source.left(),n=this.connector.source.width(),s=this.connector.destination.top(),i=this.connector.destination.height();this.startSegment.startY=Math.floor(this.connector.source.top()+this.connector.source.height()/2),Math.abs(t-e)<Math.abs(t-(e+n))?(this.startSegment.orientation=e>t?LEFT:RIGHT,this.startSegment.startX=e):(this.startSegment.orientation=t>e+n?RIGHT:LEFT,this.startSegment.startX=e+n),this.startSegment.length=Math.abs(t-this.startSegment.startX),Math.abs(this.startSegment.startY-s)<Math.abs(this.startSegment.startY-(s+i))?(this.endSegment.orientation=this.startSegment.startY<s?DOWN:UP,this.endSegment.length=Math.abs(this.startSegment.startY-s)):(this.endSegment.orientation=this.startSegment.startY>s+i?UP:DOWN,this.endSegment.length=Math.abs(this.startSegment.startY-(s+i)))}}function VerticalLStrategy(t){this.connector=t,this.startSegment,this.endSegment,this.strategyName="vertical_L",this.isApplicable=function(){var t=Math.floor(this.connector.source.left()+this.connector.source.width()/2),e=this.connector.destination.left(),n=this.connector.destination.width(),s=this.connector.source.top(),i=this.connector.source.height(),h=Math.floor(this.connector.destination.top()+this.connector.destination.height()/2);return t>e&&e+n>t?!1:h>s&&s+i>h?!1:!0},this.getMiddleSegment=function(){return this.startSegment.length>this.endSegment.length?this.startSegment:this.endSegment},this.paint=function(){this.startSegment=this.connector.createSegment(),this.endSegment=this.connector.createSegment();var t=Math.floor(this.connector.destination.top()+this.connector.destination.height()/2),e=this.connector.destination.left(),n=this.connector.destination.width(),s=this.connector.source.top(),i=this.connector.source.height();this.startSegment.startX=Math.floor(this.connector.source.left()+this.connector.source.width()/2),Math.abs(t-s)<Math.abs(t-(s+i))?(this.startSegment.orientation=s>t?UP:DOWN,this.startSegment.startY=s):(this.startSegment.orientation=t>s+i?DOWN:UP,this.startSegment.startY=s+i),this.startSegment.length=Math.abs(t-this.startSegment.startY),Math.abs(this.startSegment.startX-e)<Math.abs(this.startSegment.startX-(e+n))?(this.endSegment.orientation=this.startSegment.startX<e?RIGHT:LEFT,this.endSegment.length=Math.abs(this.startSegment.startX-e)):(this.endSegment.orientation=this.startSegment.startX>e+n?LEFT:RIGHT,this.endSegment.length=Math.abs(this.startSegment.startX-(e+n)))}}function HorizontalCStrategy(t,e){this.connector=t,this.startSegment,this.middleSegment,this.endSegment,this.strategyName="horizontal_c",this.getMiddleSegment=function(){return this.middleSegment},this.isApplicable=function(){return!0},this.paint=function(){this.startSegment=t.createSegment(),this.middleSegment=t.createSegment(),this.endSegment=t.createSegment();var n=1;e==RIGHT&&(n=-1);var s=this.connector.source.left();e==RIGHT&&(s+=this.connector.source.width());var i=Math.floor(this.connector.source.top()+this.connector.source.height()/2),h=this.connector.destination.left();e==RIGHT&&(h+=this.connector.destination.width());var o=Math.floor(this.connector.destination.top()+this.connector.destination.height()/2);this.startSegment.startX=s,this.startSegment.startY=i,this.startSegment.orientation=e,this.startSegment.length=this.connector.minSegmentLength+Math.max(0,n*(s-h));var r=o-i;this.middleSegment.orientation=r>0?DOWN:UP,this.middleSegment.length=Math.abs(r),this.endSegment.orientation=e==LEFT?RIGHT:LEFT,this.endSegment.length=Math.max(0,n*(h-s))+this.connector.minSegmentLength}}function VerticalCStrategy(t,e){this.connector=t,this.startSegment,this.middleSegment,this.endSegment,this.strategyName="vertical_c",this.getMiddleSegment=function(){return this.middleSegment},this.isApplicable=function(){return!0},this.paint=function(){this.startSegment=t.createSegment(),this.middleSegment=t.createSegment(),this.endSegment=t.createSegment();var n=1;e==DOWN&&(n=-1);var s=this.connector.source.top();e==DOWN&&(s+=this.connector.source.height());var i=Math.floor(this.connector.source.left()+this.connector.source.width()/2),h=this.connector.destination.top();e==DOWN&&(h+=this.connector.destination.height());var o=Math.floor(this.connector.destination.left()+this.connector.destination.width()/2);this.startSegment.startX=i,this.startSegment.startY=s,this.startSegment.orientation=e,this.startSegment.length=this.connector.minSegmentLength+Math.max(0,n*(s-h));var r=o-i;this.middleSegment.orientation=r>0?RIGHT:LEFT,this.middleSegment.length=Math.abs(r),this.endSegment.orientation=e==UP?DOWN:UP,this.endSegment.length=Math.max(0,n*(h-s))+this.connector.minSegmentLength}}var ie=document.all,nn6=document.getElementById&&!document.all,isdrag=!1,mouseStartX,mouseStartY,elementStartX,elementStartY,elementToMove,blocksToMove,originalZIndex,bounds=new Array(4),blocksToMoveScanner=new DocumentScanner(new BlocksToMoveVisitor,!0);document.onmousedown=startDrag,document.onmouseup=stopDrag;var LEFT=1,RIGHT=2,UP=4,DOWN=8,HORIZONTAL=LEFT+RIGHT,VERTICAL=UP+DOWN,AUTO=HORIZONTAL+VERTICAL,START=0,END=1,SCROLLBARS_WIDTH=18,inspectors=new Array,strategies=new Array;inspectors.push(new ConnectorEndsInspector),inspectors.push(new ConnectorLabelsInspector);var canvases=new Array;strategies[0]=function(t){return new HorizontalSStrategy(t)},strategies[1]=function(t){return new VerticalSStrategy(t)},strategies[2]=function(t){return new HorizontalLStrategy(t)},strategies[3]=function(t){return new VerticalLStrategy(t)},strategies[4]=function(t){return new HorizontalCStrategy(t,LEFT)},strategies[5]=function(t){return new HorizontalCStrategy(t,RIGHT)},strategies[6]=function(t){return new VerticalCStrategy(t,UP)},strategies[7]=function(t){return new VerticalCStrategy(t,DOWN)};