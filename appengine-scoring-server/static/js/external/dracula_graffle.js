Raphael.fn.connection=function(t,a,e){var x=this,i={draw:function(){for(var l=t.getBBox(),h=a.getBBox(),o=0,y=0,r=[{x:l.x+l.width/2,y:l.y-o},{x:l.x+l.width/2,y:l.y+l.height+o},{x:l.x-o,y:l.y+l.height/2},{x:l.x+l.width+o,y:l.y+l.height/2},{x:h.x+h.width/2,y:h.y-y},{x:h.x+h.width/2,y:h.y+h.height+y},{x:h.x-y,y:h.y+h.height/2},{x:h.x+h.width+y,y:h.y+h.height/2}],d={},n=[],b=0;4>b;b++)for(var f=4;8>f;f++){var s=Math.abs(r[b].x-r[f].x),g=Math.abs(r[b].y-r[f].y);(b==f-4||(3!=b&&6!=f||r[b].x<r[f].x)&&(2!=b&&7!=f||r[b].x>r[f].x)&&(0!=b&&5!=f||r[b].y>r[f].y)&&(1!=b&&4!=f||r[b].y<r[f].y))&&(n.push(s+g),d[n[n.length-1].toFixed(3)]=[b,f])}var F=0==n.length?[0,4]:d[Math.min.apply(Math,n).toFixed(3)],c=r[F[0]].x,p=r[F[0]].y,M=r[F[1]].x,w=r[F[1]].y,s=Math.max(Math.abs(c-M)/2,10),g=Math.max(Math.abs(p-w)/2,10),k=[c,c,c-s,c+s][F[0]].toFixed(3),v=[p-g,p+g,p,p][F[0]].toFixed(3),u=[0,0,0,0,M,M,M-s,M+s][F[1]].toFixed(3),B=[0,0,0,0,p+g,p-g,w,w][F[1]].toFixed(3),m=["M",c.toFixed(3),p.toFixed(3),"C",k,v,u,B,M.toFixed(3),w.toFixed(3)].join(",");if(e&&e.directed){var z=Math.sqrt((w-B)*(w-B)+(M-u)*(M-u)),L=function(t,a){return-t*(a||5)/z},j=[{x:(L(M-u)+L(w-B)+M).toFixed(3),y:(L(w-B)+L(M-u)+w).toFixed(3)},{x:(L(M-u)-L(w-B)+M).toFixed(3),y:(L(w-B)-L(M-u)+w).toFixed(3)}];m=m+",M"+j[0].x+","+j[0].y+",L"+M+","+w+",L"+j[1].x+","+j[1].y}var q="attr";i.fg&&i.fg[q]({path:m})||(i.fg=x.path(m).attr({stroke:e&&e.stroke||"#000",fill:"none"}).toBack()),i.bg&&i.bg[q]({path:m})||e&&e.fill&&(i.bg=e.fill.split&&x.path(m).attr({stroke:e.fill.split("|")[0],fill:"none","stroke-width":e.fill.split("|")[1]||3}).toBack()),e&&e.label&&(i.label&&i.label.attr({x:(c+M)/2,y:(p+w)/2})||(i.label=x.text((c+M)/2,(p+w)/2,e.label).attr({fill:"#000","font-size":e["font-size"]||"12px"}))),e&&e.label&&e["label-style"]&&i.label&&i.label.attr(e["label-style"]),e&&e.callback&&e.callback(i)}};return i.draw(),i};