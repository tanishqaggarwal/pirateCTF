function log(t){console.log&&console.log(t)}var AbstractEdge=function(){};AbstractEdge.prototype={hide:function(){this.connection.fg.hide(),this.connection.bg&&this.bg.connection.hide()}};var EdgeFactory=function(){this.template=new AbstractEdge,this.template.style=new Object,this.template.style.directed=!1,this.template.weight=1};EdgeFactory.prototype={build:function(t,i){var e=jQuery.extend(!0,{},this.template);return e.source=t,e.target=i,e}};var Graph=function(){this.nodes={},this.edges=[],this.snapshots=[],this.edgeFactory=new EdgeFactory};Graph.prototype={addNode:function(t,i){return void 0==this.nodes[t]&&(this.nodes[t]=new Graph.Node(t,i)),this.nodes[t]},addEdge:function(t,i,e){var o=this.addNode(t),a=this.addNode(i),s=this.edgeFactory.build(o,a);jQuery.extend(s.style,e),o.edges.push(s),this.edges.push(s),a.edges.push(s)},snapShot:function(){},removeNode:function(t){delete this.nodes[t];for(var i=0;i<this.edges.length;i++)(this.edges[i].source.id==t||this.edges[i].target.id==t)&&(this.edges.splice(i,1),i--)}},Graph.Node=function(t,e){return e=e||{},e.id=t,e.edges=[],e.hide=function(){this.hidden=!0,this.shape&&this.shape.hide();for(i in this.edges)(this.edges[i].source.id==t||this.edges[i].target==t)&&this.edges[i].hide&&this.edges[i].hide()},e.show=function(){this.hidden=!1,this.shape&&this.shape.show();for(i in this.edges)(this.edges[i].source.id==t||this.edges[i].target==t)&&this.edges[i].show&&this.edges[i].show()},e},Graph.Node.prototype={},Graph.Renderer={},Graph.Renderer.Raphael=function(t,i,e,o){this.width=e||400,this.height=o||400;var a=this;this.r=Raphael(t,this.width,this.height),this.radius=40,this.graph=i,this.mouse_in=!1,this.graph.render||(this.graph.render=function(){}),this.isDrag=!1,this.dragger=function(t){this.dx=t.clientX,this.dy=t.clientY,a.isDrag=this,this.set&&this.set.animate({"fill-opacity":.1},200)&&this.set.toFront(),t.preventDefault&&t.preventDefault()};var s=document.getElementById(t);s.onmousemove=function(t){if(t=t||window.event,a.isDrag){var i=a.isDrag.set.getBBox(),e=t.clientX-a.isDrag.dx+(i.x+i.width/2),o=t.clientY-a.isDrag.dy+(i.y+i.height/2),s=t.clientX-(20>e?e-20:e>a.width-20?e-a.width+20:0),r=t.clientY-(20>o?o-20:o>a.height-20?o-a.height+20:0);a.isDrag.set.translate(s-Math.round(a.isDrag.dx),r-Math.round(a.isDrag.dy));for(var h in a.graph.edges)a.graph.edges[h].connection&&a.graph.edges[h].connection.draw();a.isDrag.dx=s,a.isDrag.dy=r}},s.onmouseup=function(){a.isDrag&&a.isDrag.set.animate({"fill-opacity":.6},500),a.isDrag=!1},this.draw()},Graph.Renderer.Raphael.prototype={translate:function(t){return[(t[0]-this.graph.layoutMinX)*this.factorX+this.radius,(t[1]-this.graph.layoutMinY)*this.factorY+this.radius]},rotate:function(t,i,e){var o=i*Math.cos(e),a=i*Math.sin(e);return[t[0]+o,t[1]+a]},draw:function(){this.factorX=(this.width-2*this.radius)/(this.graph.layoutMaxX-this.graph.layoutMinX),this.factorY=(this.height-2*this.radius)/(this.graph.layoutMaxY-this.graph.layoutMinY);for(t in this.graph.nodes)this.drawNode(this.graph.nodes[t]);for(var t=0;t<this.graph.edges.length;t++)this.drawEdge(this.graph.edges[t])},drawNode:function(t){var i=this.translate([t.layoutPosX,t.layoutPosY]);if(t.point=i,t.shape){var e=t.shape.getBBox(),o={x:e.x+e.width/2,y:e.y+e.height/2};return t.shape.translate(Math.round(i[0]-o.x),Math.round(i[1]-o.y)),this.r.safari(),t}var a;t.render||(t.render=function(t,i){var e=Raphael.getColor(),o=t.ellipse(0,0,30,20).attr({fill:e,stroke:e,"stroke-width":2});return o.node.id=i.label||i.id,a=t.set().push(o).push(t.text(0,30,i.label||i.id))}),t.shapes,a=t.render(this.r,t).hide(),a.attr({"fill-opacity":.6}),a.items.forEach(function(t){t.set=a,t.node.style.cursor="move"}),a.mousedown(this.dragger);var s=a.getBBox();a.translate(Math.round(i[0]-(s.x+s.width/2)),Math.round(i[1]-(s.y+s.height/2))),t.hidden||a.show(),t.shape=a},drawEdge:function(t){if(!t.backedge){if(t.source.hidden||t.target.hidden)return void(t.connection&&t.connection.fg.hide()|t.connection.bg&&t.connection.bg.hide());if(!t.connection)return t.style&&t.style.callback&&t.style.callback(t),void(t.connection=this.r.connection(t.source.shape,t.target.shape,t.style));t.connection.fg.show(),t.connection.bg&&t.connection.bg.show(),t.connection.draw()}}},Graph.Layout={},Graph.Layout.Spring=function(t){this.graph=t,this.iterations=500,this.maxRepulsiveForceDistance=6,this.k=2,this.c=.01,this.maxVertexMovement=.5,this.layout()},Graph.Layout.Spring.prototype={layout:function(){this.layoutPrepare();for(var t=0;t<this.iterations;t++)this.layoutIteration();this.layoutCalcBounds()},layoutPrepare:function(){for(i in this.graph.nodes){var t=this.graph.nodes[i];t.layoutPosX=0,t.layoutPosY=0,t.layoutForceX=0,t.layoutForceY=0}},layoutCalcBounds:function(){var t=1/0,e=-1/0,o=1/0,a=-1/0;for(i in this.graph.nodes){var s=this.graph.nodes[i].layoutPosX,r=this.graph.nodes[i].layoutPosY;s>e&&(e=s),t>s&&(t=s),r>a&&(a=r),o>r&&(o=r)}this.graph.layoutMinX=t,this.graph.layoutMaxX=e,this.graph.layoutMinY=o,this.graph.layoutMaxY=a},layoutIteration:function(){var t=new Array;for(var i in this.graph.nodes){var e=this.graph.nodes[i];for(var o in t){var a=this.graph.nodes[t[o]];this.layoutRepulsive(e,a)}t.push(i)}for(var s=0;s<this.graph.edges.length;s++){var r=this.graph.edges[s];this.layoutAttractive(r)}for(s in this.graph.nodes){var h=this.graph.nodes[s],n=this.c*h.layoutForceX,d=this.c*h.layoutForceY,u=this.maxVertexMovement;n>u&&(n=u),-u>n&&(n=-u),d>u&&(d=u),-u>d&&(d=-u),h.layoutPosX+=n,h.layoutPosY+=d,h.layoutForceX=0,h.layoutForceY=0}},layoutRepulsive:function(t,i){if("undefined"!=typeof t&&"undefined"!=typeof i){var e=i.layoutPosX-t.layoutPosX,o=i.layoutPosY-t.layoutPosY,a=e*e+o*o;if(.01>a){e=.1*Math.random()+.1,o=.1*Math.random()+.1;var a=e*e+o*o}var s=Math.sqrt(a);if(s<this.maxRepulsiveForceDistance){var r=this.k*this.k/s;i.layoutForceX+=r*e/s,i.layoutForceY+=r*o/s,t.layoutForceX-=r*e/s,t.layoutForceY-=r*o/s}}},layoutAttractive:function(t){var i=t.source,e=t.target,o=e.layoutPosX-i.layoutPosX,a=e.layoutPosY-i.layoutPosY,s=o*o+a*a;if(.01>s){o=.1*Math.random()+.1,a=.1*Math.random()+.1;var s=o*o+a*a}var r=Math.sqrt(s);r>this.maxRepulsiveForceDistance&&(r=this.maxRepulsiveForceDistance,s=r*r);var h=(s-this.k*this.k)/this.k;void 0==t.attraction&&(t.attraction=1),h*=.5*Math.log(t.attraction)+1,e.layoutForceX-=h*o/r,e.layoutForceY-=h*a/r,i.layoutForceX+=h*o/r,i.layoutForceY+=h*a/r}},Graph.Layout.Ordered=function(t,i){this.graph=t,this.order=i,this.layout()},Graph.Layout.Ordered.prototype={layout:function(){this.layoutPrepare(),this.layoutCalcBounds()},layoutPrepare:function(){for(i in this.graph.nodes){var t=this.graph.nodes[i];t.layoutPosX=0,t.layoutPosY=0}var e=0;for(i in this.order){var t=this.order[i];t.layoutPosX=e,t.layoutPosY=Math.random(),e++}},layoutCalcBounds:function(){var t=1/0,e=-1/0,o=1/0,a=-1/0;for(i in this.graph.nodes){var s=this.graph.nodes[i].layoutPosX,r=this.graph.nodes[i].layoutPosY;s>e&&(e=s),t>s&&(t=s),r>a&&(a=r),o>r&&(o=r)}this.graph.layoutMinX=t,this.graph.layoutMaxX=e,this.graph.layoutMinY=o,this.graph.layoutMaxY=a}},Raphael.el.tooltip=function(t){return this.tp=t,this.tp.o={x:0,y:0},this.tp.hide(),this.hover(function(){this.mousemove(function(t){this.tp.translate(t.clientX-this.tp.o.x,t.clientY-this.tp.o.y),this.tp.o={x:t.clientX,y:t.clientY}}),this.tp.show().toFront()},function(){this.tp.hide(),this.unmousemove()}),this},Array.prototype.forEach||(Array.prototype.forEach=function(t){var i=this.length;if("function"!=typeof t)throw new TypeError;for(var e=arguments[1],o=0;i>o;o++)o in this&&t.call(e,this[o],o,this)});